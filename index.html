<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—è–≤–æ–∫</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
<header class="modern-header">
  <div class="header-top">
    <h1>¬´–ù–ü–¶ –ê–≥—Ä–æ–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏¬ª</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ email, —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ –ø–æ–¥–∞—á–µ –∑–∞—è–≤–∫–∏,<br>—á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å.</p>

    <div class="inputmail">
      <input type="email" id="email" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
      <button onclick="checkStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>
  </div>

  <nav class="header-links">
    <a href="form.html">üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É</a>
    <a href="new.html">üì∞ –ù–æ–≤–æ—Å—Ç–∏</a>
  </nav>
</header>
  


  <main>
    <div class="sidebar" id="sidebar"></div>
    <div class="content" id="details"></div>
  </main>

  <script>
    let entries = [];

    function formatDate(input) {
      if (!input) return "‚Äî";
      const date = new Date(input);
      if (isNaN(date)) return input;
      date.setHours(date.getHours() + 1);
      return date.toLocaleDateString("ru-RU", {
        day: "numeric", month: "long", year: "numeric", hour: "2-digit", minute: "2-digit"
      });
    }

    function getFileLink(link) {
      if (!link || link === "-" || link.length < 10) return `<i style="color:gray">–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</i>`;
      if (link.includes("drive.google.com")) {
        const match = link.match(/[-\w]{25,}/);
        if (match) {
          const fileId = match[0];
          const directUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;
          return `<a href="${directUrl}" target="_blank">üì• –°–∫–∞—á–∞—Ç—å</a>`;
        } else return `<a href="${link}" target="_blank">üìÇ –û—Ç–∫—Ä—ã—Ç—å</a>`;
      }
      if (!link.includes("http")) return `<i style="color:gray">–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ —Å—Å—ã–ª–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</i>`;
      return `<a href="${link}" target="_blank">üìÇ –û—Ç–∫—Ä—ã—Ç—å</a>`;
    }

    async function checkStatus() {
      const email = document.getElementById("email").value.trim().toLowerCase();
      const url = `https://script.google.com/macros/s/AKfycbx5V9YBKypfzwoq7wxf8_2_Y9CwJbAAiU2wplWVVtiHb-JPzS1OILvXgGbj8BMdLybulA/exec?email=${encodeURIComponent(email)}`;
      const sidebar = document.getElementById("sidebar");
      const details = document.getElementById("details");
      sidebar.innerHTML = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...";
      details.innerHTML = "";

      try {
        const res = await fetch(url);
        const data = await res.json();

        entries = data.results.filter(e => (e["–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã"] || "").trim().toLowerCase() === email);

        if (!entries.length) {
          sidebar.innerHTML = "<p>–î–∞–Ω–Ω—ã—Ö –ø–æ email –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>";
          return;
        }

        entries.sort((a, b) => new Date(b["–û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏"]) - new Date(a["–û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏"]));

      if (status.includes("–æ—Ç–∫–ª")) statusColor = "#f8d7da";
      else if (status.includes("–æ–¥–æ–±—Ä") || status.includes("–¥–µ–π—Å—Ç–≤")) statusColor = "#d4edda";
       else if (status.includes("–∑–∞–≤–µ—Ä—à") || status.includes("–æ–¥–æ–±—Ä")) statusColor = "#00ff08";
      else if (status.includes("–æ–∂–∏–¥")) statusColor = "#97e6f5";

        sidebar.innerHTML = entries.map((entry, index) => `
          <div class="entry-summary" onclick="showDetails(${index})">
          <hr>
            üìÖ ${formatDate(entry["–û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏"])}<br>
            üìç ${entry["–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–í–•"] || "-"}<br>
            üöõ –ü–æ–ª—É—á–∞—Ç–µ–ª—å: ${entry["–ü–æ–ª—É—á–∞—Ç–µ–ª—å"] || "-"}
        <b>üìÖ –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:</b> ${formatDate(entry["–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏"])}
          <hr>
              <h4><b>–°—Ç–∞—Ç—É—Å:</b> ${entry["–°—Ç–∞—Ç—É—Å"] || "–í –æ–∂–∏–¥–∞–Ω–∏–∏"}</h4>
          </div>
        `).join("");
      } catch (e) {
        sidebar.innerHTML = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.";
        console.error(e);
      }
    }

    function showDetails(index) {
      const entry = entries[index];
      const details = document.getElementById("details");

      const status = (entry["–°—Ç–∞—Ç—É—Å"] || "-").toLowerCase();
      let statusColor = "#d1ecf1";
      if (status.includes("–æ—Ç–∫–ª")) statusColor = "#f8d7da";
      else if (status.includes("–æ–¥–æ–±—Ä") || status.includes("–¥–µ–π—Å—Ç–≤")) statusColor = "#d4edda";
       else if (status.includes("–∑–∞–≤–µ—Ä—à") || status.includes("–æ–¥–æ–±—Ä")) statusColor = "#00ff08";
      else if (status.includes("–æ–∂–∏–¥")) statusColor = "#97e6f5";

      details.innerHTML = `
        <div class="box">
          <h3>üìå –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
          <b>üìÖ –û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:</b> ${formatDate(entry["–û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏"])}<br>
          <b>üìç –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–í–•:</b> ${entry["–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –°–í–•"] || "-"}<br>
          <b>üìÜ –î–∞—Ç—ã:</b> ${formatDate(entry["–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞—Ç—ã, –æ—Ç "])} ‚Äî ${formatDate(entry["–î–æ"])}<br>
          <b>üöú –¢–µ—Ö–Ω–∏–∫–∞:</b> ${entry["–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Ö–Ω–∏–∫–∏"] || "-"}<br>
          <b>üìé –î–æ–∫—É–º–µ–Ω—Ç:</b><br>${getFileLink(entry["–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"])}<br>
          <b>üè¢ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</b> ${entry["–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞"] || "-"}<br>
          <b>üè¢ –¢–æ–≤–∞—Ä:</b> ${entry["–¢–æ–≤–∞—Ä"] || "-"}<br>
          <b>üè¢ –ü—Ä–æ—Ñ–∏–ª—å —Ä–∏—Å–∫–∞:</b> ${entry["–ü—Ä–æ—Ñ–∏–ª—å —Ä–∏—Å–∫–∞"] || "-"}<br>
          <b>üè¢ –£–∫–∞–∑–∞–Ω–∞—è –¥–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</b> ${entry["–£–∫–∞–∂–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"] || "-"}<br>
          <b>üè¢ –ü–æ–ª—É—á–∞—Ç–µ–ª—å:</b> ${entry["–ü–æ–ª—É—á–∞—Ç–µ–ª—å"] || "-"}<br>
        </div>

        <div class="box cheker" style="background-color: ${statusColor};">
          <h3>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞</h3>
          <b>–°—Ç–∞—Ç—É—Å:</b> ${entry["–°—Ç–∞—Ç—É—Å"] || "–í –æ–∂–∏–¥–∞–Ω–∏–∏"}<br>
          <b>üìÖ –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:</b> ${formatDate(entry["–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏"])}<br>
          <b>üìÅ –ö–æ–Ω–µ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:</b><br>${getFileLink(entry["–ö–æ–Ω–µ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç"])}<br>
          <b>üìÖ –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</b> ${entry["–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏"] || "-"}<br>
          <b>üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ 1:</b> ${entry["–°–æ—Ç—Ä—É–¥–Ω–∏–∫"] || "-"}<br>
          <b>üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ 2:</b> ${entry["–°–æ—Ç—Ä—É–¥–Ω–∏–∫2"] || "-"}<br>
        </div>
      `;
    }
  </script>
</body>
</html>

